<!DOCTYPE html>
<head>
  <meta id="sf-canvas-signed-request" content="<%= verifiedSignedRequestJSON %>" />
  <script src="https://login.salesforce.com/canvas/sdk/js/31.0/canvas-all.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/jsforce/1.3.1/jsforce.min.js"></script>
 <script type="text/javascript" src="https://thingtech.ap1.visual.force.com/canvas/sdk/js/32.0/canvas-all.js"></script>
 <!--script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script-->
  <script>
var sr = document.getElementById('sf-canvas-signed-request').content;
 // Sfdc.canvas.client.repost({refresh : true});




  // Sfdc.canvas.client.refreshSignedRequest(function(data) {

  // 	alert('the status is '+data.status);
  //       if (data.status === 200) {
  //       	alert('Helllo');
  //           var signedRequest =  data.payload.response;
  //           console.log(signedRequest);
  //           document.getElementById('signed').textContent = signedRequest;
  //           var part = signedRequest.split('.')[1];
  //            console.log(part);
  //                  document.getElementById('part').textContent = part;
  //           var obj = JSON.parse(Sfdc.canvas.decode(part));
  //           console.log(obj);
  //            document.getElementById('obj').textContent = obj;
  //       }
  //   });


function myFunction() {
	alert("In function");
Sfdc.canvas.client.refreshSignedRequest();

	  // Sfdc.canvas.client.refreshSignedRequest(function(data) {

  	// alert('the status is '+data.status);
   //      if (data.status === 200) {
   //      	alert('Helllo');
   //          var signedRequest =  data.payload.response;
   //          console.log(signedRequest);
   //          document.getElementById('signed').textContent = signedRequest;
   //          var part = signedRequest.split('.')[1];
   //           console.log(part);
   //                 document.getElementById('part').textContent = part;
   //          var obj = JSON.parse(Sfdc.canvas.decode(part));
   //          console.log(obj);
   //           document.getElementById('obj').textContent = obj;
   //      }
   //  });




   // var sr = Sfdc.canvas.client.refreshSignedRequest();
   // alert('Signed Request' +sr);
	// console.log('EEEWEWE');
// Sfdc.canvas.client.repost({refresh : true});

 // console.log(sr);
}


// Sfdc.canvas.client.refreshSignedRequest(function(data) {
//         if (data.status === 200) {
//             var signedRequest =  data.payload.response;
//             var part = signedRequest.split('.')[1];
//             var obj = JSON.parse(Sfdc.canvas.decode(part));
//         }
//     }
var conn = new jsforce.Connection({ signedRequest: sr });
conn.query('SELECT Id, Name FROM Account', function(err, res) {
  if (err) { return console.error(err); }
  console.log(res);
});
  </script>
</head>

<body>
<button onclick="myFunction()">Click me</button>
<div id="signed"></div>
<div id="part"></div>
<div id="obj"></div>
</body>
</html>